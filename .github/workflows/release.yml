name: C/C++ CI

on: [push, pull_request, workflow_dispatch]

# on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]

jobs:
  configure:
    runs-on: [self-hosted, deepr]

    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: configure
      run: |
        echo "üçè This job's status is ${{ job.status }}."
        
    - name: Build
      run: |
        echo "üçè Building"
        conan config set general.revisions_enabled=1
        conan remote add common https://deepranalytics.jfrog.io/artifactory/api/conan/deepr-common --force
        conan user ${{ secrets.CONAN_USERNAME }} -p ${{ secrets.CONAN_PASSWORD }} -r common
        conan user
        ./ci/windows-build.bat

    - name: Create Installer
      run: |
        echo "üçè Create Installer"
        ./ci/windows-package.bat
        cd

    - name: Path
      run: cd
        
    - name: Upload Installer
      uses: actions/upload-artifact@v2
      with:
          name: Scanner
          path: |
            bin/Release/Scanner-*.exe
            bin/Release/Scanner.pdb

    - name: Path
      run: |
        git clone https://github.com/manoj-k-deepr/HelloCICDRelease.git
        cd HelloCICDRelease
        cd

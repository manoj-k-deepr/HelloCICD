name: C/C++ CI

on: [push, pull_request, workflow_dispatch]

# on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]

jobs:
  configure:
    runs-on: [self-hosted, deepr]

    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: configure
      run: |
        echo "ğŸ This job's status is ${{ job.status }}."

  build:
    runs-on: [self-hosted, deepr]
    needs: configure
    steps:
    - name: Build
      run: |
        echo "ğŸ Building"
        ./ci/windows-build.bat

  create-installer:
    runs-on: [self-hosted, deepr]
    needs: build
    steps:
    - name: Create Installer
      run: |
        echo "ğŸ Create Installer"
        ./ci/windows-package.bat

  deploy:
    runs-on: [self-hosted, deepr]
    needs: create-installer
    steps:
      - name: Upload Installer
        uses: actions/upload-artifact@v2
        with:
          name: code-coverage-report
          path: bin/Release/Scanner*.exe

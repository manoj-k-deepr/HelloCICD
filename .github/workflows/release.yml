name: C/C++ CI

on: [push, pull_request, workflow_dispatch]

# on:
#   push:
#     branches: [ master ]
#   pull_request:
#     branches: [ master ]

jobs:
  configure:
    runs-on: [self-hosted, deepr]

    steps:
    - name: Check out repository code
      uses: actions/checkout@v2

    - name: configure
      run: |
        echo "üçè This job's status is ${{ job.status }}."
        set CONAN_REVISIONS_ENABLED=1
        conan remote add common https://deepranalytics.jfrog.io/artifactory/api/conan/deepr-common --force
        conan user ${{ secrets.CONAN_USERNAME }} -p ${{ secrets.CONAN_PASSWORD }} -r common
        conan remote list
        
    - name: Build
      run: |
        echo "üçè Building"
        ./ci/windows-build.bat

    - name: Create Installer
      run: |
        echo "üçè Create Installer"
        ./ci/windows-package.bat

    - name: Upload Installer
      uses: actions/upload-artifact@v2
      with:
          name: Installer
          path: |
            bin/Release/Scanner-*.exe
            Scanner.pdb

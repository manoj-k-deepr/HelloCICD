name: C/C++ CI

on: [push]
jobs:
  build-ubuntu:
    runs-on: [self-hosted, Linux, X64]
    container:
       image: deepr/devopsubuntu:latest
       credentials:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}   

    steps:     
      - name: configure
        run: |
          gcc --version
          pwd
      
      - name: Pulling git dir..
        uses: actions/checkout@v2
         
      - name: build
        run: | 
          echo "Build"
          whoami
          pwd
          chmod +x "./ci/linux-build.sh"
          "./ci/linux-build.sh" 

      - name: test
        run: echo "Test"

      - name: Clean Workspace
        run: |
          echo "Cleaning up"
          rm -rf "${{ github.workspace }}"
          
#   build-windows:
#     runs-on: [self-hosted, Windows, X64, deepr]

#     steps:
#     - uses: actions/checkout@v2
#       with:
#         token: ${{ secrets.REPO_SCOPED_TOKEN }}
#     - name: configure
#       run: echo "Configure complete"
#     - name: build
#       run: ./ci/windows-build.bat
#     - name: test
#       run: echo "Test Complete"
